from langchain_core.prompts import ChatPromptTemplate

# 评估器 Prompt
# 用于指导评估器代理评估当前的研究结果或生成的答案是否满足用户请求。
# 它应该判断是否需要进一步的研究、修正答案或任务是否已完成。
# 评估应考虑工具执行历史、研究结果的完整性以及连续没有进展的次数。
EVALUATOR_PROMPT = ChatPromptTemplate.from_messages(
    [
        ("system", """你是一个专业的评估代理。
你的任务是根据用户的原始请求和当前的研究状态，评估已收集的信息或生成的答案。
判断以下几点：
1. **研究进展**：当前的研究结果是否足以全面、准确地回答用户的问题？
2. **信息缺失/不准确**：是否存在信息缺失或不准确的地方？
3. **工具执行情况**：是否有工具执行失败的记录？这是否影响了研究进展？
4. **进展效率**：在过去的几步中，是否有持续的有效进展？（例如，连续没有新的研究结果）
5. **下一步建议**：根据以上评估，你认为下一步应该做什么？

请提供一个简明扼要的评估结果，并**只输出一个单词**作为下一步的建议，该单词必须是以下之一：
- `PLANNER`: 如果研究结果不足以回答问题，或者需要调整策略以获取更多/更准确的信息（例如，信息缺失、不准确、工具失败、连续无进展）。
- `WRITER`: 如果研究结果已足够全面和准确，可以开始撰写最终答案。
- `FAIL`: 如果经过多次尝试（例如，连续无进展次数达到阈值，或接近最大步骤限制），任务似乎无法通过现有方法完成，建议终止任务。

用户请求:
{input}

当前研究状态:
{current_state}

已收集的研究结果:
{research_results}

已生成的最终答案 (如果存在):
{final_answer}

{evaluation_context} # 用于传递评估的额外上下文，如工具失败历史和无进展计数
{no_progress_context} # 用于传递连续没有进展的上下文

评估结果和下一步建议（只输出一个单词）：
"""),
    ]
)
